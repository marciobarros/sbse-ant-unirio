package unirio.ant.architecture;

import javax.management.modelmbean.XMLParseException;

import unirio.ant.controller.CDAReader;
import unirio.ant.model.Project;
import unirio.ant.model.ProjectClass;
import unirio.ant.model.ProjectPackage;

/**
 * Class that loads real and optimized versions of Apache Ant
 * 
 * @author Marcio
 */
public class ProjectLoader
{
	/**
	 * Input directory for real versions
	 */
	private static String INPUT_DIRECTORY = "data\\odem\\";

	/**
	 * Names of the real versions
	 */
	private static String[] REAL_VERSIONS = 
	{
		"apache-ant-1.1.0",
		"apache-ant-1.2.0",
		"apache-ant-1.3.0",
		"apache-ant-1.4.0",
		"apache-ant-1.4.1",
		"apache-ant-1.5.0",
		"apache-ant-1.5.1",
		"apache-ant-1.5.2",
		"apache-ant-1.5.3",
		"apache-ant-1.5.4",
		"apache-ant-1.6.0",
		"apache-ant-1.6.1",
		"apache-ant-1.6.2",
		"apache-ant-1.6.3",
		"apache-ant-1.6.4",
		"apache-ant-1.6.5",
		"apache-ant-1.7.0",
		"apache-ant-1.7.1",
		"apache-ant-1.8.0",
		"apache-ant-1.8.1",
		"apache-ant-1.8.2",
		"apache-ant-1.8.3",
		"apache-ant-1.8.4",
		"apache-ant-1.9.0"
	};
	
	/**
	 * Known external dependencies for real versions
	 */
	private static String[] REAL_VERSION_EXTERNAL_DEPENDENCIES = 
	{
		// Versão 1.1.0
		"org.apache.tools.ant.taskdefs.optional.XalanLiaison",
		"org.apache.tools.ant.taskdefs.optional.XslpLiaison",
		// Versão 1.3.0
		"org.apache.tools.ant.taskdefs.optional.TraXLiaison",
		// Versão 1.4.0
		"at.dms.kjc.Main",
		// Versão 1.5.0
		"org.apache.tools.ant.taskdefs.optional.Test",
		"org.apache.tools.ant.taskdefs.Get",
		"org.apache.tools.ant.taskdefs.email.UUMailer",
		"org.apache.tools.ant.taskdefs.email.MimeMailer",
		// Versão 1.6.0
		"org.apache.tools.ant.launch.AntMain",
		"org.apache.tools.ant.launch.Locator",
		"org.apache.tools.ant.util.optional.WeakishReference12",
		// Versão 1.7.0
		"org.apache.tools.ant.launch.Launcher",
		"org.apache.tools.ant.util.java15.ProxyDiagnostics",
		"org.apache.tools.ant.filters.util.JavaClassHelper",
		// Versão 1.8.0
		"org.apache.tools.ant.loader.AntClassLoader5",
		"org.apache.tools.ant.taskdefs.optional.EchoProperties"
	};

	/**
	 * Optimized version for EVM
	 */
	private static String OPTIMIZED_EVM = "269 30 558 20 372 529 838 529 475 583 475 210 1020 1020 1020 800 886 237 91 319 91 880 175 919 1081 960 637 368 678 601 1040 809 827 805 559 279 207 351 968 909 564 445 162 351 408 351 878 809 271 809 351 838 1037 527 210 305 37 676 115 838 156 330 21 429 429 884 884 526 612 612 168 382 382 382 382 200 529 854 903 200 434 548 964 200 467 200 646 479 452 452 475 934 548 548 182 147 375 182 491 243 66 66 945 997 918 106 190 520 1013 997 997 997 147 81 81 742 320 956 956 515 515 455 126 899 531 531 147 1038 595 375 375 717 56 56 576 717 849 741 375 652 980 375 1114 523 523 90 637 637 90 90 722 90 90 429 90 312 200 732 200 312 402 312 200 200 637 110 110 596 110 851 155 110 378 305 696 696 696 995 160 305 45 1029 30 66 382 979 979 612 66 612 396 967 318 217 825 923 923 923 938 938 938 938 341 341 605 634 467 1083 1083 385 178 227 429 1046 4 923 924 456 393 456 902 30 283 97 1109 202 912 202 202 202 1000 202 65 1067 291 194 219 481 185 153 962 196 220 583 583 735 522 557 485 994 32 32 930 930 249 226 1095 474 5 74 74 587 587 217 599 838 639 468 237 1022 639 846 846 846 441 146 519 95 594 594 594 427 403 128 128 128 129 563 129 415 563 129 38 48 596 596 596 337 795 571 428 462 172 329 634 708 326 96 120 96 83 83 333 46 83 859 154 1023 83 1022 1022 787 690 1030 1019 770 690 79 79 58 603 58 739 434 434 952 558 1090 1042 384 558 760 760 489 462 462 462 517 462 334 462 485 607 807 240 403 870 877 118 870 366 109 121 121 408 408 636 636 566 396 331 331 331 687 687 244 513 529 529 424 437 7 432 1055 1004 1004 1004 446 568 835 731 280 57 1102 337 138 1051 765 251 687 923 820 76 820 695 542 174 291 450 1074 496 430 35 35 35 929 256 898 898 898 583 385 229 229 487 41 234 234 217 131 131 754 159 1082 1082 818 1009 1009 656 141 141 509 632 656 922 1009 823 170 11 69 377 208 198 650 565 786 297 291 634 634 552 18 908 634 315 720 263 627 1052 105 908 887 65 872 65 65 894 484 654 1008 976 736 885 589 1010 35 700 35 555 65 826 649 718 259 457 951 152 723 546 1079 352 801 472 847 82 949 318 82 335 335 78 318 82 949 949 381 189 381 381 381 381 381 624 829 829 414 829 829 1087 1078 506 414 828 258 1069 161 1088 161 161 771 659 1015 1015 156 764 764 764 313 764 744 1025 434 573 573 874 1009 759 588 29 29 922 362 362 169 533 971 1091 1091 838 681 838 838 365 838 470 838 734 943 838 838 1021 838 98 553 553 900 658 658 658 553 553 212 406 212 212 819 212 294 644 212 10 223 317 317 212 694 212 406 212 867 969 863 339 151 388 969 969 1072 969 969 969 796 796 1073 796 642 796 1073 465 498 1072 685 969 670 339 339 1094 530 77 985 701 985 701 701 779 701 448 779 985 116 448 714 985 985 985 914 221 149 221 149 221 221 514 514 514 659 659 659 659 659 292 292 493 493 683 661 618 683 683 810 618 618 618 683 156 156 156 156 156 535 615 615 615 434 321 86 737 737 737 817 645 817 171 781 114 837 837 379 379 837 152 1107 682 934 906 666 666 715 139 906 181 604 767 666 857 857 524 657 983 731 731 697 731 731 648 731 447 237 28 1040 955 488 488 488 488 838 274 838 172 514 79 1041 193 883 237 106 172 172 503 503 237 375 209 197 1057 1057 194 580 474 744 391 147 726 514 514 411 411 902 902 130 130 130 130 620 246 246 246 947 947 947 856 947 947 947 217 153 259 252 291 930 291 137 1025 542 195 562 101 101 137 101 955 955 1050 646 117 117 628 460 363 261 237 328 60 60 60 1113 782 608 1097 1028 310 1113 272 310 782 782 267 1113 291 291 557 902 569 92 812 745 12 603 942 345 528 345 1066 620 344 443 812 43 616 436 492 436 436 436 686 930 942 193 112 5 195 272 486 283 48 1097 295 295 808 133 193 15 763 932 193 830 394 250 762 193 236 998 821 540 259 762 1026 762 762 762 544 1059 1059 485 485 590 363 485 590 586 562 562 768 0 609 726 485 485 579 485 768 485 485 485 239 239 842 485 485 507 376 649 440 746 746 376 376 323 323 232 1056 850 1056 419 510 1056 1096 982 135 1056 850 390 390 254 758 153 153 400 370 214 480 480 391 349 793 391 74 74 282 1108 872 391 576 47 102 291 104 928 420 765 844 282 514 293 692 290 306 290 290 290 302 301 273 602 602 595 1032 372 344 511 511 511 420 895 322 455 497 1008 961 165 975 975 291 1110 1110 206 874 874 874 545 291 613 652 714 1106 1106 143 437 639 665 624 253 243 235 639 67 67 780 880 919 774 672 672 103 103 886 63 368 67 961 761 259 761 961 961 742 1068 9 157 157 9 9 593 187 570 797 570 426 176 426 195 195 176 163 1044 1076 806 348 413 348 276 84 610 1044 713 713 1076 51 1112 348 348 405 405 16 495 19 788 16 1044 3 1044 84 84 873 512 630 873 512 84 806 39 39 786 84 84 84";

	/**
	 * Optimized version for MQ
	 */
	private static String OPTIMIZED_MQ = "223 223 175 422 422 1039 1024 1115 1115 809 426 523 13 13 13 1019 1019 776 368 251 368 251 368 251 678 897 17 237 439 974 283 985 678 678 678 691 678 678 678 678 678 678 77 578 1002 678 691 985 678 691 678 352 882 523 523 149 598 1006 266 1006 841 910 910 704 910 169 169 401 112 112 401 626 401 626 843 897 257 693 693 693 54 749 352 316 302 266 1074 266 747 747 747 234 749 234 303 1054 783 303 783 78 293 293 412 667 667 412 412 412 667 412 667 412 343 398 398 25 783 469 469 585 585 845 303 1054 867 867 1054 1054 343 756 661 622 208 208 849 622 661 15 661 82 756 661 756 494 494 911 17 481 911 857 911 857 911 974 857 852 852 852 316 561 561 561 316 561 481 865 865 1064 931 931 1064 141 426 257 1017 1017 1017 1039 1039 149 426 223 223 110 196 762 762 112 110 112 110 424 123 1089 50 50 1104 50 772 772 772 772 486 917 40 40 302 878 878 372 1046 352 704 976 646 1104 562 562 562 562 75 220 65 54 375 414 477 414 414 477 259 259 843 828 828 462 117 352 123 917 646 375 375 375 375 1113 345 345 1113 352 342 1047 342 1047 1019 352 527 479 479 415 415 755 755 1089 1029 1029 48 525 525 327 63 419 419 419 85 352 373 373 851 851 373 372 1046 205 205 205 389 335 335 335 335 335 54 154 935 935 935 121 824 824 824 824 439 181 1014 158 158 900 900 158 565 565 600 158 565 158 158 158 158 228 228 976 531 531 1028 926 1028 926 926 178 5 178 196 600 923 797 175 797 797 797 797 970 970 195 84 84 84 957 84 80 80 117 770 356 54 1046 1007 1007 1007 1007 63 588 588 588 266 1002 367 367 169 121 1111 1111 1111 334 334 990 153 990 1115 1110 1110 352 192 192 799 799 192 973 646 181 160 244 244 244 244 235 196 1040 54 334 886 323 323 323 956 956 956 956 54 963 976 171 171 171 171 525 520 344 344 344 963 372 986 986 768 946 946 946 946 297 297 527 220 146 146 913 1067 1067 258 535 535 164 164 258 249 164 520 325 590 325 325 148 325 325 325 657 325 325 40 40 1014 1014 739 596 169 600 739 871 596 739 48 596 39 1024 95 39 39 95 95 871 220 841 95 841 1005 350 350 350 95 220 841 705 95 1056 39 39 598 236 77 841 784 95 175 39 707 424 483 436 636 636 483 483 707 1075 1075 842 235 235 842 654 654 842 877 907 628 907 907 907 907 628 989 989 628 776 457 457 1061 1061 1061 556 556 1043 177 177 332 332 332 541 541 356 195 923 514 514 410 913 66 66 66 66 249 99 995 99 99 327 465 465 337 91 1029 598 337 91 91 337 91 1029 1029 91 337 91 364 686 686 1032 311 311 1032 686 686 394 456 394 485 849 394 456 456 485 485 456 304 304 394 586 485 586 586 421 421 1006 709 274 274 274 8 318 274 318 8 540 814 548 540 540 540 548 318 274 318 709 709 709 329 329 871 594 496 757 814 758 958 958 882 814 365 882 757 958 365 594 758 757 757 117 487 487 530 530 530 530 683 683 683 708 708 708 708 708 754 754 962 962 528 574 574 1066 1066 439 326 574 326 528 868 868 177 601 601 235 217 217 217 952 952 69 69 69 69 721 721 721 721 721 337 184 184 977 977 977 1043 1043 1043 283 791 880 359 359 337 880 359 359 359 791 860 860 359 598 379 379 143 48 160 905 905 905 143 411 717 731 1071 836 836 836 836 337 525 337 569 569 973 405 706 897 886 578 835 835 801 801 195 1024 134 134 134 134 462 1068 153 770 770 717 793 683 957 750 750 75 75 748 748 748 748 55 26 26 26 854 288 288 854 854 854 288 1089 220 1056 404 404 491 768 405 15 731 1103 1036 861 861 861 861 527 1071 991 1074 925 925 410 925 971 1092 1092 265 864 864 864 491 515 706 731 180 1000 312 510 1000 515 515 312 998 520 77 180 75 93 1000 725 312 864 5 93 893 893 893 249 55 806 832 832 55 154 452 998 452 452 998 629 629 93 1021 725 725 1103 510 784 65 486 154 478 478 784 1047 1021 547 1113 547 547 706 547 547 700 1021 1036 148 809 700 1056 700 1047 700 148 700 973 587 587 1005 942 733 971 942 411 717 440 440 689 733 689 793 411 165 411 942 689 833 833 942 533 533 165 843 411 165 662 705 821 821 821 662 662 126 126 1005 11 78 11 11 692 11 692 692 692 692 78 727 727 389 730 500 500 688 688 688 688 688 730 1110 510 730 391 391 436 654 496 991 849 976 976 976 730 828 307 1040 706 236 871 865 244 119 119 119 119 119 1110 817 1110 949 949 343 828 179 806 336 336 336 307 832 523 845 141 603 559 348 348 590 784 630 630 179 410 179 410 624 624 223 82 646 712 712 54 1110 224 849 877 307 78 364 224 787 787 977 653 653 869 364 265 160 181 1019 603 237 1016 916 498 1056 498 559 916 25 189 187 124 124 187 189 189 1099 1099 1099 1099 378 227 378 1103 1103 227 125 125 12 987 883 186 186 168 712 830 6 215 215 371 12 987 371 883 248 248 795 458 458 937 795 168 6 6 85 830 204 1012 199 204 1012 199 12 370 370 657 458 371 371";
	
	/**
	 * Returns all real versions
	 */
	public String[] getRealVersions()
	{
		return REAL_VERSIONS;
	}
	
	/**
	 * Loads a real version into a project
	 */
	public Project loadRealVersion(String versao) throws XMLParseException
	{
		CDAReader reader = new CDAReader();
		reader.setIgnoredClasses(REAL_VERSION_EXTERNAL_DEPENDENCIES);
		return reader.execute(INPUT_DIRECTORY + versao + ".odem");
	}
	
	/**
	 * Loads an optimized version into a project
	 */
	private Project loadOptimizedVersion(String solution) throws XMLParseException
	{
		CDAReader reader = new CDAReader();
		reader.setIgnoredClasses(REAL_VERSION_EXTERNAL_DEPENDENCIES);
		Project project = reader.execute("data\\odem\\apache-ant-1.9.0.odem");
		project.clearPackages();

		String[] tokens = solution.split(" ");
		
		for (int i = 0; i < tokens.length; i++)
		{
			ProjectClass _class = project.getClassIndex(i);
			int packageNumber = Integer.parseInt(tokens[i]);
			
			while (project.getPackageCount() <= packageNumber)
				project.addPackage("" + project.getPackageCount());
			
			ProjectPackage _package = project.getPackageIndex(packageNumber);
			_class.setPackage(_package);
		}
		
		return project;
	}
	
	/**
	 * Loads the version optimized for EVM
	 */
	public Project loadOptimizedVersionEVM() throws XMLParseException
	{
		return loadOptimizedVersion(OPTIMIZED_EVM);
	}

	/**
	 * Loads the version optimized for MQ
	 */
	public Project loadOptimizedVersionMQ() throws XMLParseException
	{
		return loadOptimizedVersion(OPTIMIZED_MQ);
	}
}